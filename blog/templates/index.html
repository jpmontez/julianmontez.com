{% extends "base.html" %}

{% block content %}
  {% for post in posts %}
    {% set is_first_post = loop.first %}
    <article class="post {{ post.layout }}">
      <div class="post-header">
        {% if post.title %}
          <div class="title">
            {{ post.title }}
          </div>
        {% endif %}
      </div>

      {% if post.images_meta %}
        {% for image in post.images_meta %}
          {% set is_lcp = is_first_post and loop.first %}
          <figure>
            <img
              src="{{ assets_prefix }}/{{ image.primary_src or image.path }}"
              alt="{{ image.alt if image.alt is not none else (post.title or 'Photo') }}"
              loading="{{ 'eager' if is_lcp else 'lazy' }}"
              {% if is_lcp %}
              fetchpriority="high"
              {% endif %}
              {% if image.srcset %}
              srcset="{% for variant, variant_width in image.srcset %}{{ assets_prefix }}/{{ variant }} {{ variant_width }}w{% if not loop.last %}, {% endif %}{% endfor %}"
              sizes="(max-width: 720px) 100vw, 520px"
              {% endif %}
              decoding="async"
              {% if image.width and image.height %}width="{{ image.width }}" height="{{ image.height }}"{% endif %}
            />
          </figure>
        {% endfor %}
      {% endif %}

      {% if post.excerpt %}
        <div class="body" style="text-align: center;">
          <p>{{ post.excerpt }}</p>
        </div>
      {% elif post.body_html %}
        <div class="body">
          {{ post.body_html | safe }}
        </div>
      {% endif %}

      <div class="meta">
        <a href="{{ assets_prefix }}/{{ post.url }}">{{ post.display_date }}</a>
      </div>
    </article>
  {% else %}
    <div class="feed-nav">No posts yet — add Markdown files under blog/posts/YYYY/MM/</div>
  {% endfor %}

  {% if pagination and pagination.total_pages > 1 %}
    <div class="feed-nav">
      {% if pagination.prev_url %}
        <a href="{{ pagination.prev_url }}">Newer</a>
      {% endif %}
      {% if pagination.prev_url and pagination.next_url %} • {% endif %}
      {% if pagination.next_url %}
        <a href="{{ pagination.next_url }}">Older</a>
      {% endif %}
      <div class="meta" style="margin-top:8px; letter-spacing: 0.08em;">
        Page {{ pagination.current_page }} of {{ pagination.total_pages }}
      </div>
    </div>
  {% endif %}
{% endblock %}
